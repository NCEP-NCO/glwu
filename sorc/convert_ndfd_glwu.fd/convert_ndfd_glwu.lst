Page 1           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

      1 !/ ------------------------------------------------------------------- /
      2 	PROGRAM CONVERT_NDFD
      3 !/
      4 !$$$ MAIN PROGRAM DOCUMENTATION BLOCK
      5 !
      6 ! MAIN PROGRAM: CONVERT_NDFD	input preprocessor for WAVEWATCH III preprocessor
      7 ! PRGMMR: ARUN CHAWLA	DATE:2007-12-07
      8 !
      9 ! ABSTRACT: Aim of this code is to take the output from ndfd grib2 files that have been 
     10 !           decoded by wgrib2 using the spread sheet function and get them into an 
     11 !           acceptable format for WW3_PREP
     12 !
     13 ! PROGRAM HISTORY LOG:
     14 ! 2007-12-07 : Origination
     15 ! 2012-06-20 : Modified to include air-sea temp diff placeholder (JH ALVES)
     16 ! 2013-09-17 : adjusted to 2km NDFD grids (JH ALVES)
     17 ! 2013-09-21 : Made grid adjustable to grib2 files using ALLOCATE (JH ALVES)
     18 !
     19 ! USAGE:
     20 !
     21 ! INPUT FILE: 
     22 !   UNIT 11  - INPUT WIND SPEED DATA (wspd.txt)
     23 !   UNIT 12 -  INPUT WIND DIRECTION DATA (wdir.txt)
     24 !
     25 ! OUTPUT FILES:
     26 !   UNIT 51 - LAT LON FILE (ll.dat)
     27 !   UNIT 52 - DATA FILE (wdata.dat)
     28 !   UNIT 53 - MASK FILE (wmask.dat)
     29 !
     30 ! SUBPROGRAMS CALLED:
     31 ! UNIQUE:   - TICK21
     32 !
     33 !! ATTRIBUTES:
     34 !   LANGUAGE: FORTRAN 90, single threaded
     35 !   MACHINE:  Portable code
     36 !
     37 !$$$
     38 ! 1. Purpose
     39 !    This program takes the decoded wgrib2 data (that has been decoded using the spread sheet option)
     40 !    and writes out a lat-lon data file and a u,v data file in a form that can be used by ww3_prep to
     41 !    generate a wind.ww3 file
     42 !
     43 ! 2, Parameters
     44 !    Local variables
     45 !   ------------------------------------------------------------------
     46 !	NXL	Int	Number of variables along longitudes
     47 !	NYL	Int 	Number of values along latitude
     48 !	WND1	R.A.	Wind Speed
     49 !	WND2	R.A.	Wind direction
     50 !	LON	R.A.	Longitude
     51 !	LAT	R.A.	Latitude
     52 !	TIME 	I.A.	Time in an integer array of size 2
     53 !	DTIME	Real	Time increment in seconds
     54 !   ------------------------------------------------------------------
     55 !
     56 ! 3. Subroutines used
     57 !      Name      Type  Module   Description

Page 2           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

     58 !     ----------------------------------------------------------------
     59 !	TICK21	Subr.	W3TIMEMD	Advance time field
     60 !     ----------------------------------------------------------------
     61 !
     62 ! 4. Source code
     63 !
     64 	USE W3TIMEMD, ONLY: TICK21
     65 	USE CONSTANTS
     66 !
     67 	IMPLICIT NONE
     68 !
     69 !/--------------------------------------------------------------------/
     70 !	LOCAL PARAMETERS
     71 !
     72 	INTEGER		NXL,NYL,TIME(2),STIME(2)
     73 !
     74 !       PARAMETER	( NXL = 2145 )
     75 !       PARAMETER	( NYL = 1377 )
     76 !
     77 	REAL, ALLOCATABLE :: LON(:,:), LAT(:,:), WND1(:,:), &
     78 			     WND2(:,:), U(:,:), V(:,:), &
     79                              DTEMP(:,:)
     80         REAL            DTIME
     81 	LOGICAL		WRITELL 
     82 	INTEGER, ALLOCATABLE :: MASK(:,:)
     83 	INTEGER		I,J, NCOUNT, ICOUNT
     84         CHARACTER         :: DIRUVC*3
     85 !
     86 !/--------------------------------------------------------------------/
     87 
     88 !
     89 	READ(*,*) NCOUNT, DIRUVC
     90                 SELECT CASE(TRIM(DIRUVC(1:3)))
     91                   CASE('UVC')
     92 	OPEN(UNIT=11,FILE='ugrd.txt',STATUS='OLD')
     93 	OPEN(UNIT=12,FILE='vgrd.txt',STATUS='OLD')
     94                   CASE('DIR')
     95 	OPEN(UNIT=11,FILE='wspd.txt',STATUS='OLD')
     96 	OPEN(UNIT=12,FILE='wdir.txt',STATUS='OLD')
     97                 END SELECT
     98 	OPEN(UNIT=13,FILE='stamp.txt',STATUS='OLD')
     99 	OPEN(UNIT=14,FILE='dimgrid.txt',STATUS='OLD')
    100 	OPEN(UNIT=50,FILE='lat.dat',STATUS='NEW')
    101 	OPEN(UNIT=51,FILE='lon.dat',STATUS='NEW')
    102 	OPEN(UNIT=52,FILE='wmask.dat',STATUS='NEW')
    103 	OPEN(UNIT=53,FILE='udata.dat',STATUS='NEW')
    104 	OPEN(UNIT=54,FILE='vdata.dat',STATUS='NEW')
    105 	OPEN(UNIT=55,FILE='tdata.dat',STATUS='NEW')
    106 !
    107 	WRITELL = .TRUE.
    108 
    109         DO ICOUNT = 1,NCOUNT
    110 !	
    111 	   READ(13,*,END=800)STIME(1),STIME(2)
    112 	   TIME(1) = STIME(1)/100
    113 	   TIME(2) = 0
    114            DTIME = (STIME(1)-TIME(1)*100+STIME(2))*3600

Page 3           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

    115 	   CALL TICK21(TIME,DTIME)
    116 !
    117 	   READ(14,*)NXL,NYL
    118            ALLOCATE ( LON(NXL,NYL), LAT(NXL,NYL), WND1(NXL,NYL), &
    119                              WND2(NXL,NYL), U(NXL,NYL), V(NXL,NYL), &
    120                              DTEMP(NXL,NYL), MASK(NXL,NYL) )
    121 
    122            READ(11,*)
    123            READ(12,*)
    124 !
    125            DO J = 1,NYL
    126 	      DO I = 1,NXL
    127 		READ(11,*)LON(I,J),LAT(I,J),WND1(I,J)
    128 		READ(12,*)LON(I,J),LAT(I,J),WND2(I,J)
    129               ENDDO
    130            ENDDO
    131            WRITE(*,*)'END READ'
    132 
    133            SELECT CASE(TRIM(DIRUVC(1:3)))     
    134 
    135            CASE('UVC')
    136              V(:,:) = WND2(:,:)
    137              U(:,:) = WND1(:,:)
    138 
    139            CASE('DIR')
    140              V(:,:) = -WND1*COS(DERA*WND2(:,:))
    141              U(:,:) = -WND1*SIN(DERA*WND2(:,:))
    142 
    143           END SELECT
    144 
    145            DTEMP(:,:) = 0.
    146            MASK(:,:) = 1
    147 
    148            WHERE (WND1 > 9000.)
    149              V = 9999.
    150              U = 9999.
    151              DTEMP = 9999.
    152              MASK = 0
    153            END WHERE                   
    154 
    155            WRITE(*,*)'END CONVERT'
    156 !   
    157            WRITE(*,*)TIME
    158 	   WRITE(53,*)TIME
    159 	   
    160            DO J = 1,NYL
    161              IF (WRITELL) THEN
    162 	       WRITE(50,*)(LAT(I,J),I=1,NXL)
    163 	       WRITE(51,*)(LON(I,J)-360.,I=1,NXL)
    164 	       WRITE(52,*)(MASK(I,J),I=1,NXL)
    165 	     END IF
    166 	     WRITE(53,*)(U(I,J),I=1,NXL)
    167 	     WRITE(54,*)(V(I,J),I=1,NXL)
    168              WRITE(55,*)(DTEMP(I,J),I=1,NXL)
    169            END DO
    170            WRITELL = .FALSE.
    171         END DO

Page 4           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

    172 !
    173   800   CONTINUE
    174 	CLOSE(11)
    175 	CLOSE(12)
    176 	CLOSE(13)
    177 	CLOSE(50)
    178 	CLOSE(51)
    179 	CLOSE(52)
    180 	CLOSE(53)
    181 	CLOSE(54)
    182 	CLOSE(55)
    183 !
    184 	END PROGRAM CONVERT_NDFD 


ENTRY POINTS

  Name              
                    
 MAIN__             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 800                        Label  173                                                            111                               
 CONSTANTS                  Module 65                                                             65                                
 CONVERT_NDFD               Prog   2                                                                                                
 COS                        Func   140                                  scalar                    140                               
 DERA                       Param  140      R(4)            4           scalar                    140,141                           
 DIRUVC                     Local  84       CHAR            3           scalar                    89,90,133                         
 DTEMP                      Local  79       R(4)            4     2     1        ALC              120,145,151,168                   
 DTIME                      Local  80       R(4)            4           scalar                    114,115                           
 I                          Local  83       I(4)            4           scalar                    126,127,128,162,163,164,166,167,16
                                                                                                  8                                 
 ICOUNT                     Local  83       I(4)            4           scalar                    109                               
 J                          Local  83       I(4)            4           scalar                    125,127,128,160,162,163,164,166,16
                                                                                                  7,168                             
 LAT                        Local  77       R(4)            4     2     1        ALC              118,127,128,162                   
 LON                        Local  77       R(4)            4     2     1        ALC              118,127,128,163                   
 MASK                       Local  82       I(4)            4     2     1        ALC              120,146,152,164                   
 NCOUNT                     Local  83       I(4)            4           scalar                    89,109                            
 NXL                        Local  72       I(4)            4           scalar                    117,118,119,120,126,162,163,164,16
                                                                                                  6,167,168                         
 NYL                        Local  72       I(4)            4           scalar                    117,118,119,120,125,160           
 SIN                        Func   141                                  scalar                    141                               
 STIME                      Local  72       I(4)            4     1     2                         111,112,114                       
 TICK21                     Subr   64                                                             64,115                            
 TIME                       Local  72       I(4)            4     1     2                         112,113,114,115,157,158           
 TRIM                       Func   90                                   scalar                    90,133                            
 U                          Local  78       R(4)            4     2     1        ALC              119,137,141,150,166               
 V                          Local  78       R(4)            4     2     1        ALC              119,136,140,149,167               
 W3TIMEMD                   Module 64                                                             64                                
 WND1                       Local  77       R(4)            4     2     1        ALC              118,127,137,140,141,148           
 WND2                       Local  78       R(4)            4     2     1        ALC              119,128,136,140,141               
 WRITELL                    Local  81       L(4)            4           scalar                    107,161,170                       

Page 5           Source Listing                  CONVERT_NDFD
2017-04-04 20:16 Subprograms/Common Blocks       convert_ndfd_glwu.f90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CONVERT_NDFD               Prog   2                                                                                                

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_ldout_format              -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume norealloc_lhs                 -assume underscore
       -assume no2underscores                -auto
  no   -auto_scalar                     no   -bintext
       -ccdefault default                    -check noargs
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check noformat
       -check nooutput_conversion            -check nooverflow
       -check nopointers                     -check power
       -check noshape                        -check nostack
       -check nounderflow                    -check nouninitialized
       -coarray-num-procs 0             no   -coarray-config-file
       -convert big_endian                   -cross_reference
       -D __INTEL_COMPILER=1500              -D __INTEL_COMPILER_UPDATE=3
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D _MT                                -D __INTEL_COMPILER_BUILD_DATE=20150407
       -D __INTEL_OFFLOAD                    -D __pentium4
       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__

Page 6           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

       -D __SSE3__                           -D __SSSE3__
       -D __SSE4_1__                         -D __SSE4_2__
       -D __SSE__                            -D __SSE_MATH__
       -D __MMX__                            -D __AVX__
       -D __AVX_I__                          -D __AVX2__
       -D __CRAYXC                           -D __CRAY_HASWELL
       -D __CRAYXT_COMPUTE_LINUX_TARGET       -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals              no   -fpconstant
       -fpe3                                 -fprm nearest
  no   -ftz                                  -fp_model noprecise
       -fp_model fast                        -fp_model nostrict
       -fp_model nosource                    -fp_model nodouble
       -fp_model noextended                  -fp_model novery_fast
       -fp_model noexcept                    -fp_model nono_except
       -heap_arrays 0                   no   -threadprivate_compat
       -free                                 -g0
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O3                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /opt/cray/rca/1.0.0-2.0502.57212.2.56.ari/include/,/opt/cray/ugni/6.0-1.0502.10245.9.9.ari/include/,
           /opt/intel/composer_xe_2015.3.187/ipp/include/,/usr/local/include/,.f90,./.f90,/opt/cray/iobuf/2.0.5/include/.f90,
           /opt/cray/mpt/7.2.0/gni/mpich2-intel/140/include/.f90,/opt/cray/libsci/13.0.3/INTEL/140/x86_64/include/.f90,
           /opt/cray/rca/1.0.0-2.0502.57212.2.56.ari/include/.f90,/opt/cray/alps/5.2.3-2.0502.9295.14.14.ari/include/.f90,
           /opt/cray/xpmem/0.1-2.0502.57015.1.15.ari/include/.f90,/opt/cray/gni-headers/4.0-1.0502.10317.9.2.ari/include/.f90,
           /opt/cray/pmi/5.0.6-1.0000.10439.140.2.ari/include/.f90,/opt/cray/ugni/6.0-1.0502.10245.9.9.ari/include/.f90,
           /opt/cray/udreg/2.3.2-1.0502.9889.2.20.ari/include/.f90,/opt/cray/wlm_detect/1.0-1.0502.57063.1.1.ari/include/.f90,
           /opt/cray/krca/1.0.0-2.0502.57202.2.45.ari/include/.f90,/opt/cray-hss-devel/7.2.0/include/.f90,/opt/intel/composer_xe_2015.3.187/ipp/include/.f90,
           /opt/intel/composer_xe_2015.3.187/mkl/include/.f90,/opt/intel/composer_xe_2015.3.187/tbb/include/.f90,
           /opt/intel/composer_xe_2015.3.187/compiler/include/intel64/.f90,/opt/intel/composer_xe_2015.3.187/compiler/include/.f90,
           /usr/local/include/.f90,/usr/lib64/gcc/x86_64-suse-linux/4.3/include/.f90,/usr/lib64/gcc/x86_64-suse-linux/4.3/include-fixed/.f90,
           /usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : convert_ndfd_glwu.lst

Page 7           Source Listing                  CONVERT_NDFD
2017-04-04 20:16                                 convert_ndfd_glwu.f90

       -o    filename : none

COMPILER: Intel(R) Fortran 15.0-1812
