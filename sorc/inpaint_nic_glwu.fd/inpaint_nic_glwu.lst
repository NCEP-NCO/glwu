Page 1           Source Listing                  READNIC
2017-04-04 20:16                                 inpaint_nic_glwu.f90

      1 PROGRAM readnic
      2 
      3 IMPLICIT NONE
      4 
      5 INTEGER :: NLON,NLAT
      6 INTEGER :: ILON, ILAT
      7 CHARACTER(LEN=20) :: FMT, FMT2
      8 REAL,ALLOCATABLE :: MASK(:,:),CICE(:,:)
      9 
     10 OPEN(12,FILE='T_OEBA88_C_KNWC.mask')
     11 OPEN(13,FILE='T_OEBA88_C_KNWC.ice')
     12 OPEN(52,FILE='T_OEBA88_C_KNWC.newice')
     13 
     14 READ (13,*)NLON,NLAT
     15 
     16 ALLOCATE(CICE(NLON,NLAT),MASK(NLON,NLAT))
     17 
     18 DO ILAT=1,NLAT
     19 DO ILON=1,NLON
     20   READ(12,*)MASK(ILON,ILAT)
     21   READ(13,*)CICE(ILON,ILAT)
     22   IF ((CICE(ILON,ILAT).EQ.9.999e+20).OR.(MASK(ILON,ILAT).EQ.-1)) THEN
     23      CICE(ILON,ILAT)=-1.
     24   ELSE 
     25      CICE(ILON,ILAT)=1E-1*CICE(ILON,ILAT)
     26 ! Unstructured grid does not yet use transparencies for ico
     27 ! (eg, FLAGTR=4 in WW3). Setting here lower ice bound to 40%
     28 ! Anything > 30% is totally blocked.
     29      IF ((CICE(ILON,ILAT).GT.0.).AND.(CICE(ILON,ILAT).LE.0.4)) THEN
     30        CICE(ILON,ILAT)=-1.
     31      ENDIF
     32   ENDIF
     33 ENDDO
     34 ENDDO
     35 
     36 CALL INPAINT(NLON,NLAT,CICE)
     37 
     38 DO ILAT=1,NLAT
     39 DO ILON=1,NLON
     40 !  WRITE(FMT,'("(",I0,"F10.4)")') NLON
     41 !  WRITE(FMT2,'("(",I0,"F6.0)")') NLON
     42   WRITE(FMT2,'("(",I0,"F6.2)")') 1
     43   WRITE(52,FMT2)MAX(0.,CICE(ILON,ILAT))
     44 ENDDO
     45 ENDDO
     46 
     47 
     48 END

Page 2           Source Listing                  READNIC
2017-04-04 20:16 Entry Points                    inpaint_nic_glwu.f90



ENTRY POINTS

  Name              
                    
 MAIN__             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CICE                       Local  8        R(4)            4     2     1        ALC              16,21,22,23,25,29,30,36,43        
 FMT                        Local  7        CHAR            20          scalar                                                      
 FMT2                       Local  7        CHAR            20          scalar                    42,43                             
 ILAT                       Local  6        I(4)            4           scalar                    18,20,21,22,23,25,29,30,38,43     
 ILON                       Local  6        I(4)            4           scalar                    19,20,21,22,23,25,29,30,39,43     
 INPAINT                    Subr   36                                                             36                                
 MASK                       Local  8        R(4)            4     2     1        ALC              16,20,22                          
 MAX                        Func   43                                   scalar                    43                                
 NLAT                       Local  5        I(4)            4           scalar                    14,16,18,36,38                    
 NLON                       Local  5        I(4)            4           scalar                    14,16,19,36,39                    
 READNIC                    Prog   1                                                                                                

Page 3           Source Listing                  READNIC
2017-04-04 20:16                                 inpaint_nic_glwu.f90

     49 
     50 ! Subroutine : inpaint
     51 ! Calling Functions : meanundef
     52 ! Author Stelios Flampouris
     53 ! v0.5.prttp
     54 ! 11.04.2015
     55 ! TODO : It needs a _main_
     56 ! 
     57 ! Variables
     58 ! xlen :: length of x-dim (e.g longtitude)
     59 ! ylen :: length of y-dim (e.g latitude)
     60 ! gap :: 2D-array(lenght(x),length(y)) integer, 0 : where must have a value, 1 : where must not have a value
     61 ! arr :: 2D-array(lenght(x),length(y)) with data which has the gaps. The gaps have NaN as values
     62 !
     63 subroutine inpaint(xlen, ylen, arr)
     64 implicit none
     65 !
     66 integer :: xlen,ylen
     67 real, dimension(xlen,ylen), intent(inout) :: arr
     68 integer, parameter :: it_max = 10
     69 ! 
     70 !local
     71 real, dimension(xlen,ylen) :: arrNaN
     72 real, dimension(2,2) :: subarr
     73 logical, dimension(xlen,ylen) :: indNaN
     74 integer :: ix, iy, indx_min, indx_max, indy_min, indy_max, ext_it
     75 integer :: strt_ix, end_ix, strt_iy, end_iy,stp_ix, stp_iy
     76 real :: UNDEF, max_val, Avg
     77 !
     78 ! 1.Basic Input Manipulation
     79 ! CLMSK
     80 max_val=maxval(arr)
     81 !
     82 arrNaN = arr
     83 UNDEF=-1
     84 indNaN = arrNaN.eq.UNDEF
     85 !
     86 do ix = 1,xlen,1
     87    do iy = 1,ylen,1
     88       if (indNaN(ix,iy)) then
     89          arrNaN(ix,iy) = UNDEF
     90          arr (ix,iy) = UNDEF
     91       endif
     92    enddo
     93 enddo
     94 
     95 ! 2. The hoop 
     96 do ext_it = 1,it_max,1
     97    do ix = 1,xlen,1
     98       do iy = 1,ylen,1
     99          indx_min = max(ix-1,1)
    100          indy_min = max(iy-1,1)
    101          indx_max = min(ix+1,xlen)
    102          indy_max = min(iy+1,ylen)
    103 
    104          if (arr(ix,iy).eq.UNDEF) then
    105              subarr=arrNaN(indx_min:indx_max,indy_min:indy_max)

Page 4           Source Listing                  MEANUNDEF
2017-04-04 20:16                                 inpaint_nic_glwu.f90

    106            if ( any(subarr .ne. UNDEF) ) then
    107              arr(ix,iy) = meanundef(arrNaN(indx_min:indx_max,indy_min:indy_max), UNDEF)
    108            end if
    109          end if
    110       end do
    111    end do
    112    arrNaN = arr
    113 end do
    114 
    115 contains
    116 
    117 function meanundef(array,UNDEF)
    118 real :: meanundef
    119 real, intent(in), dimension(:,:) :: array
    120 real, intent(in) :: UNDEF
    121 if ( any(array .ne. UNDEF) ) then
    122   meanundef = sum (array, array .ne. UNDEF) / max(1,count(array .ne. UNDEF ))
    123 else
    124   meanundef = UNDEF
    125 endif
    126 end function meanundef


ENTRY POINTS

  Name                             
                                   
 inpaint_IP_meanundef_             

Page 5           Source Listing                  MEANUNDEF
2017-04-04 20:16 Symbol Table                    inpaint_nic_glwu.f90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ANY                        Func   121                                  scalar                    106,121                           
 ARRAY                      Dummy  117      R(4)            4     2     1        ARG,IN           121,122                           
 COUNT                      Func   122                                  scalar                    122                               
 MAX                        Func   122                                  scalar                    99,100,122                        
 MEANUNDEF                  Func   117      R(4)            4           scalar                    107,122,124                       
 SUM                        Func   122                                  scalar                    122                               
 UNDEF                      Dummy  117      R(4)            4           scalar   ARG,IN           121,122,124                       

Page 6           Source Listing                  MEANUNDEF
2017-04-04 20:16                                 inpaint_nic_glwu.f90

    127 !
    128 end subroutine inpaint


ENTRY POINTS

  Name                
                      
 inpaint_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ARR                        Dummy  63       R(4)            4     2     0        ARG,INOUT        80,82,90,104,107,112              
 ARRNAN                     Local  71       R(4)            4     2     0        TGT              82,84,89,105,107,112              
 AVG                        Local  76       R(4)            4           scalar                                                      
 END_IX                     Local  75       I(4)            4           scalar                                                      
 END_IY                     Local  75       I(4)            4           scalar                                                      
 EXT_IT                     Local  74       I(4)            4           scalar                    96                                
 INDNAN                     Local  73       L(4)            4     2     0                         84,88                             
 INDX_MAX                   Local  74       I(4)            4           scalar                    101,105,107                       
 INDX_MIN                   Local  74       I(4)            4           scalar                    99,105,107                        
 INDY_MAX                   Local  74       I(4)            4           scalar                    102,105,107                       
 INDY_MIN                   Local  74       I(4)            4           scalar                    100,105,107                       
 INPAINT                    Subr   63                                                                                               
 IT_MAX                     Param  68       I(4)            4           scalar                    96                                
 IX                         Local  74       I(4)            4           scalar                    86,88,89,90,97,99,101,104,107     
 IY                         Local  74       I(4)            4           scalar                    87,88,89,90,98,100,102,104,107    
 MAXVAL                     Func   80                                   scalar                    80                                
 MAX_VAL                    Local  76       R(4)            4           scalar                    80                                
 MEANUNDEF@0                Local  117      R(4)            4           scalar                                                      
 MIN                        Func   101                                  scalar                    101,102                           
 STP_IX                     Local  75       I(4)            4           scalar                                                      
 STP_IY                     Local  75       I(4)            4           scalar                                                      
 STRT_IX                    Local  75       I(4)            4           scalar                                                      
 STRT_IY                    Local  75       I(4)            4           scalar                                                      
 SUBARR                     Local  72       R(4)            4     2     4                         105,106                           
 UNDEF                      Local  76       R(4)            4           scalar                    83,84,89,90,104,106,107           
 XLEN                       Dummy  63       I(4)            4           scalar   ARG,INOUT        67,71,73,86,97,101                
 YLEN                       Dummy  63       I(4)            4           scalar   ARG,INOUT        67,71,73,87,98,102                

Page 7           Source Listing                  MEANUNDEF
2017-04-04 20:16                                 inpaint_nic_glwu.f90

    129 

Page 8           Source Listing                  MEANUNDEF
2017-04-04 20:16 Subprograms/Common Blocks       inpaint_nic_glwu.f90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 INPAINT                    Subr   63                                                                                               
 MEANUNDEF                  Func   117      R(4)            4           scalar                    107,122,124                       
 READNIC                    Prog   1                                                                                                

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_ldout_format              -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume norealloc_lhs                 -assume underscore
       -assume no2underscores                -auto
  no   -auto_scalar                     no   -bintext
       -ccdefault default                    -check noargs
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check noformat
       -check nooutput_conversion            -check nooverflow
       -check nopointers                     -check power
       -check noshape                        -check nostack
       -check nounderflow                    -check nouninitialized
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1500              -D __INTEL_COMPILER_UPDATE=3
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D _MT                                -D __INTEL_COMPILER_BUILD_DATE=20150407
       -D __INTEL_OFFLOAD                    -D __pentium4

Page 9           Source Listing                  MEANUNDEF
2017-04-04 20:16                                 inpaint_nic_glwu.f90

       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __SSE3__                           -D __SSSE3__
       -D __SSE4_1__                         -D __SSE4_2__
       -D __SSE__                            -D __SSE_MATH__
       -D __MMX__                            -D __AVX__
       -D __AVX_I__                          -D __AVX2__
       -D __CRAYXC                           -D __CRAY_HASWELL
       -D __CRAYXT_COMPUTE_LINUX_TARGET       -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals              no   -fpconstant
       -fpe3                                 -fprm nearest
  no   -ftz                                  -fp_model noprecise
       -fp_model fast                        -fp_model nostrict
       -fp_model nosource                    -fp_model nodouble
       -fp_model noextended                  -fp_model novery_fast
       -fp_model noexcept                    -fp_model nono_except
       -heap_arrays 0                   no   -threadprivate_compat
       -free                                 -g0
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O3                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /opt/cray/rca/1.0.0-2.0502.57212.2.56.ari/include/,/opt/cray/ugni/6.0-1.0502.10245.9.9.ari/include/,
           /opt/intel/composer_xe_2015.3.187/ipp/include/,/usr/local/include/,.f90,./.f90,/opt/cray/iobuf/2.0.5/include/.f90,
           /opt/cray/mpt/7.2.0/gni/mpich2-intel/140/include/.f90,/opt/cray/libsci/13.0.3/INTEL/140/x86_64/include/.f90,
           /opt/cray/rca/1.0.0-2.0502.57212.2.56.ari/include/.f90,/opt/cray/alps/5.2.3-2.0502.9295.14.14.ari/include/.f90,
           /opt/cray/xpmem/0.1-2.0502.57015.1.15.ari/include/.f90,/opt/cray/gni-headers/4.0-1.0502.10317.9.2.ari/include/.f90,
           /opt/cray/pmi/5.0.6-1.0000.10439.140.2.ari/include/.f90,/opt/cray/ugni/6.0-1.0502.10245.9.9.ari/include/.f90,
           /opt/cray/udreg/2.3.2-1.0502.9889.2.20.ari/include/.f90,/opt/cray/wlm_detect/1.0-1.0502.57063.1.1.ari/include/.f90,
           /opt/cray/krca/1.0.0-2.0502.57202.2.45.ari/include/.f90,/opt/cray-hss-devel/7.2.0/include/.f90,/opt/intel/composer_xe_2015.3.187/ipp/include/.f90,
           /opt/intel/composer_xe_2015.3.187/mkl/include/.f90,/opt/intel/composer_xe_2015.3.187/tbb/include/.f90,
           /opt/intel/composer_xe_2015.3.187/compiler/include/intel64/.f90,/opt/intel/composer_xe_2015.3.187/compiler/include/.f90,
           /usr/local/include/.f90,/usr/lib64/gcc/x86_64-suse-linux/4.3/include/.f90,/usr/lib64/gcc/x86_64-suse-linux/4.3/include-fixed/.f90,

Page 10          Source Listing                  MEANUNDEF
2017-04-04 20:16                                 inpaint_nic_glwu.f90

           /usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : inpaint_nic_glwu.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 15.0-1812
