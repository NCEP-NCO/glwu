Page 1           Source Listing                  READNIC
2018-04-11 17:15                                 inpaint_nic_glwu.f90

      1 PROGRAM readnic
      2 
      3 IMPLICIT NONE
      4 
      5 INTEGER :: NLON,NLAT
      6 INTEGER :: ILON, ILAT
      7 CHARACTER(LEN=20) :: FMT, FMT2
      8 REAL,ALLOCATABLE :: MASK(:,:),CICE(:,:)
      9 REAL SCALEFAC
     10 
     11 OPEN(12,FILE='T_OEBA88_C_KNWC.mask')
     12 OPEN(13,FILE='T_OEBA88_C_KNWC.ice')
     13 OPEN(52,FILE='T_OEBA88_C_KNWC.newice')
     14 
     15 READ (13,*)NLON,NLAT
     16 
     17 ALLOCATE(CICE(NLON,NLAT),MASK(NLON,NLAT))
     18 
     19 !->New liines fro High Res Ice fields
     20 IF (NLON .GT. 2500) THEN
     21   SCALEFAC=1E-3
     22 ELSE
     23   SCALEFAC=1E-1
     24 ENDIF
     25 !<-end
     26 
     27 
     28 DO ILAT=1,NLAT
     29 DO ILON=1,NLON
     30   READ(12,*)MASK(ILON,ILAT)
     31   READ(13,*)CICE(ILON,ILAT)
     32 !   divide by 1000 for the High Resolution Ice conc.
     33 
     34   IF ((CICE(ILON,ILAT).EQ.9.999e+20).OR.(MASK(ILON,ILAT).EQ.-1)) THEN
     35      CICE(ILON,ILAT)=-1.
     36   ELSE 
     37 !    CICE(ILON,ILAT)=1E-1*CICE(ILON,ILAT)
     38 !    ->New line for High Res Ice. Replace the line above
     39      CICE(ILON,ILAT)=SCALEFAC*CICE(ILON,ILAT)
     40 
     41 ! Unstructured grid does not yet use transparencies for ico
     42 ! (eg, FLAGTR=4 in WW3). Setting here lower ice bound to 40%
     43 ! Anything > 30% is totally blocked.
     44      IF ((CICE(ILON,ILAT).GT.0.).AND.(CICE(ILON,ILAT).LE.0.4)) THEN
     45        CICE(ILON,ILAT)=-1.
     46      ENDIF
     47   ENDIF
     48 ENDDO
     49 ENDDO
     50 
     51 CALL INPAINT(NLON,NLAT,CICE)
     52 
     53 DO ILAT=1,NLAT
     54 DO ILON=1,NLON
     55 !  WRITE(FMT,'("(",I0,"F10.4)")') NLON
     56 !  WRITE(FMT2,'("(",I0,"F6.0)")') NLON
     57   WRITE(FMT2,'("(",I0,"F6.2)")') 1

Page 2           Source Listing                  READNIC
2018-04-11 17:15                                 inpaint_nic_glwu.f90

     58   WRITE(52,FMT2)MAX(0.,CICE(ILON,ILAT))
     59 ENDDO
     60 ENDDO
     61 
     62 
     63 END


ENTRY POINTS

  Name              
                    
 MAIN__             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CICE                       Local  8        R(4)            4     2     1        ALC              17,31,34,35,39,44,45,51,58        
 FMT                        Local  7        CHAR            20          scalar                                                      
 FMT2                       Local  7        CHAR            20          scalar                    57,58                             
 ILAT                       Local  6        I(4)            4           scalar                    28,30,31,34,35,39,44,45,53,58     
 ILON                       Local  6        I(4)            4           scalar                    29,30,31,34,35,39,44,45,54,58     
 INPAINT                    Subr   51                                                             51                                
 MASK                       Local  8        R(4)            4     2     1        ALC              17,30,34                          
 MAX                        Func   58                                   scalar                    58                                
 NLAT                       Local  5        I(4)            4           scalar                    15,17,28,51,53                    
 NLON                       Local  5        I(4)            4           scalar                    15,17,20,29,51,54                 
 READNIC                    Prog   1                                                                                                
 SCALEFAC                   Local  9        R(4)            4           scalar                    21,23,39                          

Page 3           Source Listing                  READNIC
2018-04-11 17:15                                 inpaint_nic_glwu.f90

     64 
     65 ! Subroutine : inpaint
     66 ! Calling Functions : meanundef
     67 ! Author Stelios Flampouris
     68 ! v0.5.prttp
     69 ! 11.04.2015
     70 ! TODO : It needs a _main_
     71 ! 
     72 ! Variables
     73 ! xlen :: length of x-dim (e.g longtitude)
     74 ! ylen :: length of y-dim (e.g latitude)
     75 ! gap :: 2D-array(lenght(x),length(y)) integer, 0 : where must have a value, 1 : where must not have a value
     76 ! arr :: 2D-array(lenght(x),length(y)) with data which has the gaps. The gaps have NaN as values
     77 !
     78 subroutine inpaint(xlen, ylen, arr)
     79 implicit none
     80 !
     81 integer :: xlen,ylen
     82 real, dimension(xlen,ylen), intent(inout) :: arr
     83 integer, parameter :: it_max = 10
     84 ! 
     85 !local
     86 real, dimension(xlen,ylen) :: arrNaN
     87 real, dimension(2,2) :: subarr
     88 logical, dimension(xlen,ylen) :: indNaN
     89 integer :: ix, iy, indx_min, indx_max, indy_min, indy_max, ext_it
     90 integer :: strt_ix, end_ix, strt_iy, end_iy,stp_ix, stp_iy
     91 real :: UNDEF, max_val, Avg
     92 !
     93 ! 1.Basic Input Manipulation
     94 ! CLMSK
     95 max_val=maxval(arr)
     96 !
     97 arrNaN = arr
     98 UNDEF=-1
     99 indNaN = arrNaN.eq.UNDEF
    100 !
    101 do ix = 1,xlen,1
    102    do iy = 1,ylen,1
    103       if (indNaN(ix,iy)) then
    104          arrNaN(ix,iy) = UNDEF
    105          arr (ix,iy) = UNDEF
    106       endif
    107    enddo
    108 enddo
    109 
    110 ! 2. The hoop 
    111 do ext_it = 1,it_max,1
    112    do ix = 1,xlen,1
    113       do iy = 1,ylen,1
    114          indx_min = max(ix-1,1)
    115          indy_min = max(iy-1,1)
    116          indx_max = min(ix+1,xlen)
    117          indy_max = min(iy+1,ylen)
    118 
    119          if (arr(ix,iy).eq.UNDEF) then
    120              subarr=arrNaN(indx_min:indx_max,indy_min:indy_max)

Page 4           Source Listing                  MEANUNDEF
2018-04-11 17:15                                 inpaint_nic_glwu.f90

    121            if ( any(subarr .ne. UNDEF) ) then
    122              arr(ix,iy) = meanundef(arrNaN(indx_min:indx_max,indy_min:indy_max), UNDEF)
    123            end if
    124          end if
    125       end do
    126    end do
    127    arrNaN = arr
    128 end do
    129 
    130 contains
    131 
    132 function meanundef(array,UNDEF)
    133 real :: meanundef
    134 real, intent(in), dimension(:,:) :: array
    135 real, intent(in) :: UNDEF
    136 if ( any(array .ne. UNDEF) ) then
    137   meanundef = sum (array, array .ne. UNDEF) / max(1,count(array .ne. UNDEF ))
    138 else
    139   meanundef = UNDEF
    140 endif
    141 end function meanundef


ENTRY POINTS

  Name                             
                                   
 inpaint_IP_meanundef_             

Page 5           Source Listing                  MEANUNDEF
2018-04-11 17:15 Symbol Table                    inpaint_nic_glwu.f90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ANY                        Func   136                                  scalar                    121,136                           
 ARRAY                      Dummy  132      R(4)            4     2     1        ARG,IN           136,137                           
 COUNT                      Func   137                                  scalar                    137                               
 MAX                        Func   137                                  scalar                    114,115,137                       
 MEANUNDEF                  Func   132      R(4)            4           scalar                    122,137,139                       
 SUM                        Func   137                                  scalar                    137                               
 UNDEF                      Dummy  132      R(4)            4           scalar   ARG,IN           136,137,139                       

Page 6           Source Listing                  MEANUNDEF
2018-04-11 17:15                                 inpaint_nic_glwu.f90

    142 !
    143 end subroutine inpaint


ENTRY POINTS

  Name                
                      
 inpaint_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ARR                        Dummy  78       R(4)            4     2     0        ARG,INOUT        95,97,105,119,122,127             
 ARRNAN                     Local  86       R(4)            4     2     0        TGT              97,99,104,120,122,127             
 AVG                        Local  91       R(4)            4           scalar                                                      
 END_IX                     Local  90       I(4)            4           scalar                                                      
 END_IY                     Local  90       I(4)            4           scalar                                                      
 EXT_IT                     Local  89       I(4)            4           scalar                    111                               
 INDNAN                     Local  88       L(4)            4     2     0                         99,103                            
 INDX_MAX                   Local  89       I(4)            4           scalar                    116,120,122                       
 INDX_MIN                   Local  89       I(4)            4           scalar                    114,120,122                       
 INDY_MAX                   Local  89       I(4)            4           scalar                    117,120,122                       
 INDY_MIN                   Local  89       I(4)            4           scalar                    115,120,122                       
 INPAINT                    Subr   78                                                                                               
 IT_MAX                     Param  83       I(4)            4           scalar                    111                               
 IX                         Local  89       I(4)            4           scalar                    101,103,104,105,112,114,116,119,12
                                                                                                  2                                 
 IY                         Local  89       I(4)            4           scalar                    102,103,104,105,113,115,117,119,12
                                                                                                  2                                 
 MAXVAL                     Func   95                                   scalar                    95                                
 MAX_VAL                    Local  91       R(4)            4           scalar                    95                                
 MEANUNDEF@0                Local  132      R(4)            4           scalar                                                      
 MIN                        Func   116                                  scalar                    116,117                           
 STP_IX                     Local  90       I(4)            4           scalar                                                      
 STP_IY                     Local  90       I(4)            4           scalar                                                      
 STRT_IX                    Local  90       I(4)            4           scalar                                                      
 STRT_IY                    Local  90       I(4)            4           scalar                                                      
 SUBARR                     Local  87       R(4)            4     2     4                         120,121                           
 UNDEF                      Local  91       R(4)            4           scalar                    98,99,104,105,119,121,122         
 XLEN                       Dummy  78       I(4)            4           scalar   ARG,INOUT        82,86,88,101,112,116              
 YLEN                       Dummy  78       I(4)            4           scalar   ARG,INOUT        82,86,88,102,113,117              

Page 7           Source Listing                  MEANUNDEF
2018-04-11 17:15                                 inpaint_nic_glwu.f90

    144 

Page 8           Source Listing                  MEANUNDEF
2018-04-11 17:15 Subprograms/Common Blocks       inpaint_nic_glwu.f90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 INPAINT                    Subr   78                                                                                               
 MEANUNDEF                  Func   132      R(4)            4           scalar                    122,137,139                       
 READNIC                    Prog   1                                                                                                

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_ldout_format              -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume norealloc_lhs                 -assume underscore
       -assume no2underscores                -auto
  no   -auto_scalar                     no   -bintext
       -ccdefault default                    -check noargs
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check noformat
       -check nooutput_conversion            -check nooverflow
       -check nopointers                     -check power
       -check noshape                        -check nostack
       -check nounderflow                    -check nouninitialized
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1500              -D __INTEL_COMPILER_UPDATE=3
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D _MT                                -D __INTEL_COMPILER_BUILD_DATE=20150407
       -D __INTEL_OFFLOAD                    -D __pentium4

Page 9           Source Listing                  MEANUNDEF
2018-04-11 17:15                                 inpaint_nic_glwu.f90

       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __SSE3__                           -D __SSSE3__
       -D __SSE4_1__                         -D __SSE4_2__
       -D __SSE__                            -D __SSE_MATH__
       -D __MMX__                            -D __AVX__
       -D __AVX_I__                          -D __AVX2__
       -D __CRAYXC                           -D __CRAY_HASWELL
       -D __CRAYXT_COMPUTE_LINUX_TARGET       -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals              no   -fpconstant
       -fpe3                                 -fprm nearest
  no   -ftz                                  -fp_model noprecise
       -fp_model fast                        -fp_model nostrict
       -fp_model nosource                    -fp_model nodouble
       -fp_model noextended                  -fp_model novery_fast
       -fp_model noexcept                    -fp_model nono_except
       -heap_arrays 0                   no   -threadprivate_compat
       -free                                 -g0
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O3                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /opt/cray/alps/5.2.3-2.0502.9295.14.14.ari/include/,/opt/cray/udreg/2.3.2-1.0502.9889.2.20.ari/include/,
           /opt/intel/composer_xe_2015.3.187/mkl/include/,/usr/lib64/gcc/x86_64-suse-linux/4.3/include/,.f,./.f,/opt/cray/mpt/7.2.0/gni/mpich2-intel/140/include/.f,
           /opt/cray/libsci/13.0.3/INTEL/140/x86_64/include/.f,/opt/cray/rca/1.0.0-2.0502.57212.2.56.ari/include/.f,
           /opt/cray/alps/5.2.3-2.0502.9295.14.14.ari/include/.f,/opt/cray/xpmem/0.1-2.0502.57015.1.15.ari/include/.f,
           /opt/cray/gni-headers/4.0-1.0502.10317.9.2.ari/include/.f,/opt/cray/pmi/5.0.6-1.0000.10439.140.2.ari/include/.f,
           /opt/cray/ugni/6.0-1.0502.10245.9.9.ari/include/.f,/opt/cray/udreg/2.3.2-1.0502.9889.2.20.ari/include/.f,
           /opt/cray/wlm_detect/1.0-1.0502.57063.1.1.ari/include/.f,/opt/cray/krca/1.0.0-2.0502.57202.2.45.ari/include/.f,
           /opt/cray-hss-devel/7.2.0/include/.f,/opt/intel/composer_xe_2015.3.187/ipp/include/.f,/opt/intel/composer_xe_2015.3.187/mkl/include/.f,
           /opt/intel/composer_xe_2015.3.187/tbb/include/.f,/opt/intel/composer_xe_2015.3.187/compiler/include/intel64/.f,
           /opt/intel/composer_xe_2015.3.187/compiler/include/.f,/usr/local/include/.f,/usr/lib64/gcc/x86_64-suse-linux/4.3/include/.f,
           /usr/lib64/gcc/x86_64-suse-linux/4.3/include-fixed/.f,/usr/include/.f,/usr/include/.f,/usr/include/.f

Page 10          Source Listing                  MEANUNDEF
2018-04-11 17:15                                 inpaint_nic_glwu.f90

       -list filename : inpaint_nic_glwu.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 15.0-1812
